<Window x:Class="TouchGanttChart.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TouchGanttChart"
        xmlns:controls="clr-namespace:TouchGanttChart.Controls"
        xmlns:converters="clr-namespace:TouchGanttChart.Converters"
        mc:Ignorable="d"
        Title="{Binding Title}" 
        Height="800" 
        Width="1200"
        MinHeight="600"
        MinWidth="800"
        Loaded="MainWindow_Loaded"
        Closing="MainWindow_Closing"
        IsManipulationEnabled="True"
        WindowState="Maximized">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        <converters:TimelineViewModeDisplayConverter x:Key="TimelineViewModeDisplayConverter"/>
        <converters:TimelineViewModeIconConverter x:Key="TimelineViewModeIconConverter"/>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Touch-optimized toolbar -->
        <StackPanel Grid.Row="0" 
                    Orientation="Horizontal" 
                    Background="#f8f9fa"
                    Margin="0,0,0,8">
            
            <Button Content="New Project" 
                    Command="{Binding NewProjectCommand}"
                    MinHeight="44" MinWidth="120"
                    Margin="8" Padding="16,12"
                    FontSize="14" FontWeight="SemiBold"/>
            
            <Button Content="Open Project" 
                    Command="{Binding OpenProjectCommand}"
                    MinHeight="44" MinWidth="120"
                    Margin="8" Padding="16,12"
                    FontSize="14" FontWeight="SemiBold"/>
            
            <Button Content="Save" 
                    Command="{Binding SaveCommand}"
                    MinHeight="44" MinWidth="80"
                    Margin="8" Padding="16,12"
                    FontSize="14" FontWeight="SemiBold"/>
            
            <Separator Margin="8,0"/>
            
            <Button Content="Add Task" 
                    Command="{Binding AddTaskCommand}"
                    MinHeight="44" MinWidth="100"
                    Margin="8" Padding="16,12"
                    FontSize="14" FontWeight="SemiBold"/>
            
            <Button Content="Dependencies" 
                    Command="{Binding ManageDependenciesCommand}"
                    MinHeight="44" MinWidth="120"
                    Margin="8" Padding="16,12"
                    FontSize="14" FontWeight="SemiBold"/>
            
            <Button Content="Export PDF" 
                    Command="{Binding ExportPdfCommand}"
                    MinHeight="44" MinWidth="120"
                    Margin="8" Padding="16,12"
                    FontSize="14" FontWeight="SemiBold"/>
            
            <Separator Margin="8,0"/>
            
            <!-- Timeline View Mode Controls -->
            <TextBlock Text="View:" 
                       VerticalAlignment="Center" 
                       FontWeight="SemiBold"
                       Margin="8,0,4,0"/>
            
            <ComboBox ItemsSource="{Binding TimelineViewOptions}"
                      SelectedItem="{Binding ViewMode}"
                      MinHeight="44" MinWidth="140"
                      Margin="4,8,8,8" Padding="12,8"
                      FontSize="14">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Converter={StaticResource TimelineViewModeIconConverter}}" 
                                       FontSize="14" 
                                       Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding Converter={StaticResource TimelineViewModeDisplayConverter}}" 
                                       FontSize="14"/>
                        </StackPanel>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            
            <Separator Margin="8,0"/>
            
            <!-- Zoom Controls -->
            <Button Content="🔍−" 
                    Command="{Binding ZoomOutCommand}"
                    MinHeight="44" MinWidth="44"
                    Margin="4,8,0,8" Padding="8"
                    FontSize="16" FontWeight="Bold"
                    ToolTip="Zoom Out"/>
            
            <Button Content="🔍+" 
                    Command="{Binding ZoomInCommand}"
                    MinHeight="44" MinWidth="44"
                    Margin="0,8,4,8" Padding="8"
                    FontSize="16" FontWeight="Bold"
                    ToolTip="Zoom In"/>
            
            <Button Content="↻" 
                    Command="{Binding ZoomResetCommand}"
                    MinHeight="44" MinWidth="44"
                    Margin="0,8,8,8" Padding="8"
                    FontSize="16" FontWeight="Bold"
                    ToolTip="Reset Zoom"/>
            
        </StackPanel>

        <!-- Main content area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" MinWidth="200"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Task List Panel -->
            <controls:TaskListPanel Grid.Column="0"
                                    DataContext="{Binding}"
                                    SelectedTask="{Binding SelectedTask, Mode=TwoWay}"
                                    TaskSelected="OnTaskSelected"
                                    TaskEditRequested="OnTaskEditRequested"
                                    Background="White"
                                    BorderBrush="#dee2e6"
                                    BorderThickness="0,0,1,0"/>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" 
                          Width="8" 
                          HorizontalAlignment="Stretch"
                          Background="#dee2e6"/>

            <!-- Gantt chart area -->
            <Border Grid.Column="2" 
                    Background="White">
                
                <ScrollViewer x:Name="GanttScrollViewer"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto"
                              IsManipulationEnabled="True">
                    
                    <!-- Gantt Timeline Canvas -->
                    <controls:GanttTimelineCanvas x:Name="GanttCanvas"
                                                  Tasks="{Binding Tasks}"
                                                  TimelineStart="{Binding TimelineStart}"
                                                  TimelineEnd="{Binding TimelineEnd}"
                                                  ZoomLevel="{Binding ZoomLevel, Mode=TwoWay}"
                                                  SelectedTask="{Binding SelectedTask, Mode=TwoWay}"
                                                  ViewMode="{Binding ViewMode}"
                                                  Background="White"
                                                  MinHeight="400"
                                                  MinWidth="800"/>
                    
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Status bar -->
        <StatusBar Grid.Row="2" 
                   Height="32"
                   Background="#f8f9fa">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Zoom: " Margin="0,0,4,0"/>
                    <TextBlock Text="{Binding ZoomLevel, StringFormat=P0}" Margin="0,0,16,0"/>
                    <ProgressBar Width="120" 
                                 Height="16"
                                 IsIndeterminate="{Binding IsLoading}"
                                 Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisConverter}}"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>

    </Grid>

</Window>
